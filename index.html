<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Image Compare Slider</title>
<style>
body {
  margin:0;
  background:#111;
  display:flex;
  justify-content:center;
  align-items:center;
  min-height:100vh;
  font-family:sans-serif;
  color:#eee;
}

.container {
  position: relative;
  width: 100%;
  max-width: 100vw;
  text-align:center;
}

.frame {
  position: relative;
  overflow: hidden;
  margin: 0 auto;
}

.frame img {
  position: absolute;
  top:0;
  left:0;
  display:block;
}

.clip {
  position: absolute;
  top:0;
  left:0;
  overflow: hidden;
}

.divider {
  position:absolute;
  top:0;
  width:2px;
  height:100%;
  background:rgba(255,255,255,0.8);
  pointer-events:none;
}

.handle {
  position:absolute;
  top:50%;
  transform:translate(-50%,-50%);
  width:28px;
  height:28px;
  border-radius:50%;
  background:#fff;
  border:2px solid #000;
  cursor:ew-resize;
  z-index:10;
}

/* ラベルを画像左端と右端に固定 */
.labels {
  position: absolute;
  top: 10px;
  left: 0;
  width: 100%;
  padding: 0 10px;
  z-index:20;
  font-weight: bold;
  display: flex;
}

.labels span:first-child {
  flex: 1;
  text-align: center;
}

.labels span:last-child {
  flex: 1;
  text-align: center;
}
</style>
</head>
<body>
<div class="container">
  <div class="frame" id="cmp" data-before="before.png" data-after="after.png">
    <div class="labels">
      <span>←Before</span>
      <span>After→</span>
    </div>
    <img id="baseImg" alt="before">
    <div id="clip" class="clip">
      <img id="topImg" alt="after">
    </div>
    <div id="divider" class="divider"></div>
    <div id="handle" class="handle"></div>
  </div>
</div>

<script>
(function(){
  const cmp = document.getElementById('cmp');
  const baseImg = document.getElementById('baseImg');
  const topImg = document.getElementById('topImg');
  const clip = document.getElementById('clip');
  const handle = document.getElementById('handle');
  const divider = document.getElementById('divider');

  baseImg.src = cmp.dataset.before || 'before.png';
  topImg.src = cmp.dataset.after || 'after.png';

  let percent = 50;

  function fitFrame(){
    if(!baseImg.naturalWidth || !baseImg.naturalHeight) return;

    const maxWidth = window.innerWidth;
    const scale = Math.min(1, maxWidth / baseImg.naturalWidth);
    const w = baseImg.naturalWidth * scale;
    const h = baseImg.naturalHeight * scale;

    cmp.style.width = w + 'px';
    cmp.style.height = h + 'px';

    baseImg.style.width = w + 'px';
    baseImg.style.height = h + 'px';

    topImg.style.width = w + 'px';
    topImg.style.height = h + 'px';

    clip.style.height = h + 'px';
    divider.style.height = h + 'px';
    handle.style.top = (h/2)+'px';

    update(percent);
  }

  function update(p){
    percent = Math.max(0, Math.min(100, p));
    const w = cmp.clientWidth;
    clip.style.width = (w*percent/100)+'px';
    divider.style.left = (w*percent/100)+'px';
    handle.style.left = (w*percent/100)+'px';
  }

  baseImg.addEventListener('load', fitFrame);
  window.addEventListener('resize', fitFrame);
  if(baseImg.complete) fitFrame();

  let dragging = false;

  function startDrag(e){
    e.preventDefault();
    dragging = true;
  }

  function moveDrag(e){
    if(!dragging) return;
    const clientX = e.touches ? e.touches[0].clientX : e.clientX;
    const rect = cmp.getBoundingClientRect();
    update((clientX - rect.left)/rect.width*100);
  }

  function endDrag(e){
    dragging = false;
  }

  handle.addEventListener('pointerdown', startDrag);
  handle.addEventListener('touchstart', startDrag, {passive:false});

  document.addEventListener('pointermove', moveDrag);
  document.addEventListener('pointerup', endDrag);
  document.addEventListener('touchmove', moveDrag, {passive:false});
  document.addEventListener('touchend', endDrag);

  cmp.addEventListener('pointerdown', e=>{
    if(e.target===handle) return;
    const rect = cmp.getBoundingClientRect();
    update((e.clientX - rect.left)/rect.width*100);
  });
  cmp.addEventListener('touchstart', e=>{
    if(e.target===handle) return;
    const rect = cmp.getBoundingClientRect();
    update((e.touches[0].clientX - rect.left)/rect.width*100);
  });
})();
</script>
</body>
</html>
